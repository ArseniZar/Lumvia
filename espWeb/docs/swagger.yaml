openapi: 3.0.0
info:
  title: espWeb
  description: |
    OpenAPI specification for the built-in ESP8266 web server (WebServer).
    Generated from the backend implementation (WebServer.cpp, DeviceModels.*,
    ApiParse/ApiSerialization).
  version: 1.0.0

servers:
  - url: http://192.168.4.1/
    description: ESP8266 access point

paths:
  "/":
    get:
      summary: Get web UI
      description: Returns the HTML page with the configuration UI.
      responses:
        "200":
          description: HTML index page
          content:
            text/html:
              schema:
                type: string
    options:
      summary: CORS preflight for root
      responses:
        "200":
          description: CORS preflight accepted

  "/scan/start":
    get:
      summary: Start Wi‑Fi scan
      description: Starts scanning for available Wi‑Fi networks.
      responses:
        "200":
          description: Scan started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScanNetworkStartedResponseEnvelope"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    options:
      summary: CORS preflight for /scan/start
      responses:
        "200":
          description: CORS preflight accepted

  "/scan/status":
    get:
      summary: Get Wi‑Fi scan status
      description: Returns the current status of the Wi‑Fi scanning operation.
      responses:
        "200":
          description: Scan status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScanStatusResponseEnvelope"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    options:
      summary: CORS preflight for /scan/status
      responses:
        "200":
          description: CORS preflight accepted

  "/scan/result":
    get:
      summary: Get Wi‑Fi scan results
      description: Returns the list of discovered Wi‑Fi networks and their parameters.
      responses:
        "200":
          description: Scan results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScanNetworksResponseEnvelope"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    options:
      summary: CORS preflight for /scan/result
      responses:
        "200":
          description: CORS preflight accepted

  "/connect/start":
    post:
      summary: Start connection to Wi‑Fi network
      description: |
        Accepts a Wi‑Fi network description and initiates a connection attempt.
        The request body must contain a `data` object with network fields.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConnectNetworkRequestEnvelope"
      responses:
        "200":
          description: Connection attempt started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConnectNetworkResponseEnvelope"
        "400":
          description: Bad request (empty body, invalid JSON, etc.)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    options:
      summary: CORS preflight for /connect/start
      responses:
        "200":
          description: CORS preflight accepted

  "/connect/status":
    get:
      summary: Get Wi‑Fi connection status
      description: Returns the current Wi‑Fi connection state.
      responses:
        "200":
          description: Wi‑Fi connection status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WifiStatusResponseEnvelope"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    options:
      summary: CORS preflight for /connect/status
      responses:
        "200":
          description: CORS preflight accepted

  "/end":
    get:
      summary: Stop web server
      description: Stops the WebServer and returns HTTP 200 with an empty body.
      responses:
        "200":
          description: Server stopped successfully
    options:
      summary: CORS preflight for /end
      responses:
        "200":
          description: CORS preflight accepted

components:
  schemas:
    ErrorResponse:
      type: object
      description: API error (ApiErrorResponse).
      properties:
        ok:
          type: boolean
          enum: [false]
          example: false
        error_code:
          type: integer
          description: HTTP status code / error code.
          example: 400
        message:
          type: string
          description: Error description.
          example: "Bad request"
      required: [ok, error_code, message]

    Network:
      type: object
      description: Wi‑Fi network model (api::Network).
      properties:
        ssid:
          type: string
          example: "HomeWiFi"
        password:
          type: string
          example: "12345678"
        rssi:
          type: integer
          description: Signal strength in dBm.
          example: -40
        encryptionType:
          type: integer
          description: Encryption type (enum value from the Wi‑Fi library).
          example: 7
        channel:
          type: integer
          example: 6
        bssid:
          type: string
          example: "00:11:22:33:44:55"
        hidden:
          type: boolean
          example: false
      required: [ssid, password, rssi, encryptionType, channel, bssid, hidden]

    ScanNetworkStartedResult:
      type: object
      description: result field for the /scan/start response.
      properties:
        scan:
          type: object
          properties:
            started:
              type: boolean
              description: Indicates whether the scan was started successfully.
              example: true
          required: [started]
      required: [scan]

    ScanStatusResult:
      type: object
      description: result field for the /scan/status response.
      properties:
        status:
          type: object
          properties:
            code:
              type: integer
              description: |
                Scan status code (enum ScanState):
                  * -2 — FAILED
                  * -1 — RUNNING
                  * 0  — COMPLETED
              enum: [-2, -1, 0]
              example: 0
          required: [code]
      required: [status]

    ScanNetworksResult:
      type: object
      description: result field for the /scan/result response.
      properties:
        networks:
          type: array
          items:
            $ref: "#/components/schemas/Network"
      required: [networks]

    ConnectNetworkRequestEnvelope:
      type: object
      description: Request body for /connect/start.
      properties:
        data:
          $ref: "#/components/schemas/Network"
      required: [data]

    ConnectNetworkResult:
      type: object
      description: result field for the /connect/start response.
      properties:
        connect:
          type: object
          properties:
            started:
              type: boolean
              description: Indicates whether the connection attempt was initiated.
              example: true
          required: [started]
      required: [connect]

    WifiStatusResult:
      type: object
      description: result field for the /connect/status response.
      properties:
        status:
          type: object
          properties:
            code:
              type: integer
              description: |
                Connection state code (enum ConnState):
                  * 255 — WL_NO_SHIELD
                  * 0   — WL_IDLE_STATUS
                  * 1   — WL_NO_SSID_AVAIL
                  * 2   — WL_SCAN_COMPLETED
                  * 3   — WL_CONNECTED
                  * 4   — WL_CONNECT_FAILED
                  * 5   — WL_CONNECTION_LOST
                  * 6   — WL_WRONG_PASSWORD
                  * 7   — WL_DISCONNECTED
              enum: [255, 0, 1, 2, 3, 4, 5, 6, 7]
              example: 3
          required: [code]
      required: [status]

    ScanNetworkStartedResponseEnvelope:
      type: object
      description: Successful response ApiSuccessResponse<ScanNetworkStartedResponce>.
      properties:
        ok:
          type: boolean
          enum: [true]
          example: true
        result:
          $ref: "#/components/schemas/ScanNetworkStartedResult"
      required: [ok, result]

    ScanStatusResponseEnvelope:
      type: object
      description: Successful response ApiSuccessResponse<ScanStatusResponce>.
      properties:
        ok:
          type: boolean
          enum: [true]
          example: true
        result:
          $ref: "#/components/schemas/ScanStatusResult"
      required: [ok, result]

    ScanNetworksResponseEnvelope:
      type: object
      description: Successful response ApiSuccessResponse<ScanNetworkResponce>.
      properties:
        ok:
          type: boolean
          enum: [true]
          example: true
        result:
          $ref: "#/components/schemas/ScanNetworksResult"
      required: [ok, result]

    ConnectNetworkResponseEnvelope:
      type: object
      description: Successful response ApiSuccessResponse<ConnectNetworkResponce>.
      properties:
        ok:
          type: boolean
          enum: [true]
          example: true
        result:
          $ref: "#/components/schemas/ConnectNetworkResult"
      required: [ok, result]

    WifiStatusResponseEnvelope:
      type: object
      description: Successful response ApiSuccessResponse<WifiStatusResponce>.
      properties:
        ok:
          type: boolean
          enum: [true]
          example: true
        result:
          $ref: "#/components/schemas/WifiStatusResult"
      required: [ok, result]
